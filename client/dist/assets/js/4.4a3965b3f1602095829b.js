(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{127:function(e,t,n){"use strict";t.a=n.p+"assets/img/flower.30323aa8579c2171493519aafd942e43.png"},128:function(e,t,n){"use strict";t.a=n.p+"assets/img/rock.2d506a59ea4729f0801b8a78617d483b.png"},129:function(e,t,n){"use strict";t.a=n.p+"assets/img/location.5f42084df6b646e665d17f099f380ca3.png"},130:function(e,t,n){"use strict";var r=n(0);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var a=r.createElement("path",{d:"M106 0v512l150-145.789L406 512V0z"});t.a=function(e){return r.createElement("svg",o({viewBox:"0 0 512 512"},e),a)}},149:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return Je}));var r=n(0),o=n.n(r),a=n(3),s=n(16),i=n(17),c=n.n(i),u=(n(40),n(2)),l=n(28),p=n(129),f=n(127),m=n(128),d=n(130),h=n(13),y=n.p+"assets/img/avatar-default.522560c8ca5313e66b8c3c2616cc932c.png";function b(e){return(b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=S(e);if(t){var o=S(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return w(this,n)}}function w(e,t){return!t||"object"!==b(t)&&"function"!=typeof t?k(e):t}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var O=Object(s.b)((function(e){return{isLoggedIn:e.currentUser.isLoggedIn,currentUser:e.currentUser.userData,isOpen:e.popup.isOpen,socket:e.socket.socket}}),(function(e){return{onOpen:function(){return e({type:u.h})}}}))(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}(s,e);var t,n,r,a=_(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={isBookmark:"bookmark--unnoted",noteMessage:"",errorMessage:""},t.renderLink=t.renderLink.bind(k(t)),t.bookmark=h.a.bind(k(t)),t.toastNoti=h.i.bind(k(t)),t.updateSocket=h.k.bind(k(t)),t.isBookmark=t.isBookmark.bind(k(t)),t.isUserInArr=h.e.bind(k(t)),t}return t=s,(n=[{key:"componentDidMount",value:function(){var e=this.isBookmark(this.state,this.props);this.setState({isBookmark:e}),this.updateSocket("post","returnPostOf".concat(this.state.postId))}},{key:"isBookmark",value:function(e,t){var n=t.isLoggedIn,r=t.currentUser,o=e.post||t.header,a="bookmark--unnoted";return n&&o.notes&&(a=this.isUserInArr(o.notes,r.id)?"bookmark--noted":"bookmark--unnoted"),a}},{key:"UNSAFE_componentWillUpdate",value:function(e,t){if(this.toastNoti(t),e.isLoggedIn||(t.isBookmark="bookmark--unnoted"),e.isLoggedIn&&e.currentUser.id!=this.props.currentUser.id){var n=this.isBookmark(t,e);t.isBookmark=n}}},{key:"renderLink",value:function(){var e=this.state.post||this.props.header,t=e.writer?e.writer.avatar:y,n=e.writer?e.writer.name:"Anonymous",r=Object(h.c)(e.date),a=e.writer?"/".concat(e.writer._id):"";return a?o.a.createElement(l.b,{to:a,className:"post-header__info-writer"},o.a.createElement("img",{src:t,alt:"Writer",className:"info-writer__photo"}),o.a.createElement("div",null,o.a.createElement("span",{className:"info-writer__name"},n),o.a.createElement("span",{className:"info-writer__published-date"},r))):o.a.createElement("div",{className:"post-header__info-writer"},o.a.createElement("img",{src:t,alt:"Writer",className:"info-writer__photo"}),o.a.createElement("div",null,o.a.createElement("span",{className:"info-writer__name"},n),o.a.createElement("span",{className:"info-writer__published-date"},r)))}},{key:"render",value:function(){var e=this,t=this.state.post||this.props.header,n=this.state.isBookmark,r=this.renderLink(),a=t.flowersTotal>1?"".concat(t.flowersTotal," flowers"):"".concat(t.flowersTotal," flower"),s=t.rocksTotal>1?"".concat(t.rocksTotal," rocks"):"".concat(t.rocksTotal," rock");return o.a.createElement("div",{className:"post-header"},o.a.createElement("div",{className:"post-header__bookmark"},o.a.createElement(d.a,{onClick:function(){return e.bookmark(t._id,!1)},className:n})),o.a.createElement("h1",{className:"post-header__title"},t.name),o.a.createElement("div",{className:"post-header__address"},o.a.createElement("img",{src:p.a,alt:"Location",className:"address__icon"}),o.a.createElement("span",{className:"address__info"},t.address)),o.a.createElement("div",{className:"post-header__info"},r,o.a.createElement("div",{className:"assets__content"},o.a.createElement("div",{className:"assets__box"},o.a.createElement("img",{src:f.a,alt:"flower",className:"assets__box-icon"}),o.a.createElement("span",{className:"assets__box-name"},a)),o.a.createElement("div",{className:"assets__box"},o.a.createElement("img",{src:m.a,alt:"rock",className:"assets__box-icon"}),o.a.createElement("span",{className:"assets__box-name"},s)))))}}])&&v(t.prototype,n),r&&v(t,r),s}(r.Component));function E(e){return(E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,t){return(N=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var o=P(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return C(this,n)}}function C(e,t){return!t||"object"!==E(t)&&"function"!=typeof t?R(e):t}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var x=Object(s.b)((function(e){return{isLoggedIn:e.currentUser.isLoggedIn,currentUser:e.currentUser.userData,isOpen:e.popup.isOpen}}),(function(e){return{onOpen:function(){return e({type:u.h})}}}))(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&N(e,t)}(s,e);var t,n,r,a=I(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={flowers:"react--none",rocks:"react--none",noteMessage:"",errorMessage:""},t.react=h.f.bind(R(t)),t.renderLink=t.renderLink.bind(R(t)),t.isReact=t.isReact.bind(R(t)),t.toastNoti=h.i.bind(R(t)),t.updateSocket=h.k.bind(R(t)),t.isUserInArr=h.e.bind(R(t)),t}return t=s,(n=[{key:"componentDidMount",value:function(){var e=this.isReact(this.state,this.props),t=e.flowers,n=e.rocks;this.setState({flowers:t,rocks:n})}},{key:"isReact",value:function(e,t){var n,r,o=this.props,a=o.currentUser,s=o.isLoggedIn,i=e.post||t.footer;return s&&(n=this.isUserInArr(i.flowers,a.id)?"react--reacted":"react--none",r=this.isUserInArr(i.rocks,a.id)?"react--reacted":"react--none"),{flowers:n,rocks:r}}},{key:"UNSAFE_componentWillUpdate",value:function(e,t){if(this.toastNoti(t),this.updateSocket("post","returnPostOf".concat(this.state.postId)),e.isLoggedIn||(t.flowers="react--none",t.rocks="react--none"),e.isLoggedIn){var n=this.isReact(t,e),r=n.flowers,o=n.rocks;t.flowers=r||this.state.flowers,t.rocks=o||this.state.rocks}}},{key:"renderLink",value:function(){var e=this.state.post||this.props.footer,t=e.writer?e.writer.avatar:y,n=e.writer?e.writer.name:"Anonymous",r=e.writer?"/".concat(e.writer._id):"";return r?o.a.createElement(l.b,{to:r,className:"post-footer__writer-info"},o.a.createElement("img",{src:t,alt:"Writer",className:"post-footer__writer-photo"}),o.a.createElement("span",{className:"post-footer__writer-name"},n)):o.a.createElement("div",{className:"post-footer__writer-info"},o.a.createElement("img",{src:t,alt:"Writer",className:"post-footer__writer-photo"}),o.a.createElement("span",{className:"post-footer__writer-name"},n))}},{key:"render",value:function(){var e=this,t=this.props.footer,n=this.renderLink(),r=this.state,a=r.flowers,s=r.rocks;return o.a.createElement("div",{className:"post-footer"},o.a.createElement("div",{className:"post-footer__reaction"},o.a.createElement("h4",{className:"post-footer__title"},"Reactions"),o.a.createElement("div",{className:"post-footer__reaction-content"},o.a.createElement("div",{className:"post-footer__reaction-box "+a,onClick:function(){return e.react("flowers",t._id,e.props.currentUser.id)}},o.a.createElement("img",{src:f.a,alt:"flower",className:"reaction-box__icon"}),o.a.createElement("span",{className:"reaction-box__title"},"Give a flower")),o.a.createElement("div",{className:"post-footer__reaction-box "+s,onClick:function(){return e.react("rocks",t._id,e.props.currentUser.id)}},o.a.createElement("img",{src:m.a,alt:"rock",className:"reaction-box__icon"}),o.a.createElement("span",{className:"reaction-box__title"},"Throw a rock")))),o.a.createElement("div",{className:"post-footer__spacer"}),o.a.createElement("div",{className:"post-footer__writer"},o.a.createElement("h4",{className:"post-footer__title"},"Written by"),n))}}])&&j(t.prototype,n),r&&j(t,r),s}(r.Component));function D(e){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function T(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function U(e,t){return(U=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function L(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=W(e);if(t){var o=W(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return z(this,n)}}function z(e,t){return!t||"object"!==D(t)&&"function"!=typeof t?F(e):t}function F(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function W(e){return(W=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var A=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&U(e,t)}(s,e);var t,n,r,a=L(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).inputHandler=t.inputHandler.bind(F(t)),t}return t=s,(n=[{key:"inputHandler",value:function(e){if(this.props.onChange instanceof Function){var t=e.target.value;this.props.onChange(t)}}},{key:"render",value:function(){return o.a.createElement("div",{className:"dropdown"},o.a.createElement("span",{className:"dropdown__title"},"Sort by"),o.a.createElement("select",{className:"dropdown__content",onChange:this.inputHandler},o.a.createElement("option",{value:"newest",defaultValue:this.props.value},"Newest"),o.a.createElement("option",{value:"oldest"},"Oldest")))}}])&&T(t.prototype,n),r&&T(t,r),s}(r.Component),B=n(1),M=n(4),H=r.useLayoutEffect,G=function(e){var t=Object(r.useRef)(e);return H((function(){t.current=e})),t},J=function(e,t){"function"!=typeof e?e.current=t:e(t)},V=function(e,t){var n=Object(r.useRef)();return Object(r.useCallback)((function(r){e.current=r,n.current&&J(n.current,null),n.current=t,t&&J(t,r)}),[t])},K={"min-height":"0","max-height":"none",height:"0",visibility:"hidden",overflow:"hidden",position:"absolute","z-index":"-1000",top:"0",right:"0"},Q=function(e){Object.keys(K).forEach((function(t){e.style.setProperty(t,K[t],"important")}))},Y=null;var q=function(){},$=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopWidth","boxSizing","fontFamily","fontSize","fontStyle","fontWeight","letterSpacing","lineHeight","paddingBottom","paddingLeft","paddingRight","paddingTop","tabSize","textIndent","textRendering","textTransform","width"],X=!!document.documentElement.currentStyle,Z=function(e,t){var n=e.cacheMeasurements,o=e.maxRows,a=e.minRows,s=e.onChange,i=void 0===s?q:s,c=e.onHeightChange,u=void 0===c?q:c,l=Object(M.a)(e,["cacheMeasurements","maxRows","minRows","onChange","onHeightChange"]);var p,f=void 0!==l.value,m=Object(r.useRef)(null),d=V(m,t),h=Object(r.useRef)(0),y=Object(r.useRef)(),b=function(){var e=m.current,t=n&&y.current?y.current:function(e){var t=window.getComputedStyle(e);if(null===t)return null;var n,r=(n=t,$.reduce((function(e,t){return e[t]=n[t],e}),{})),o=r.boxSizing;return""===o?null:(X&&"border-box"===o&&(r.width=parseFloat(r.width)+parseFloat(r.borderRightWidth)+parseFloat(r.borderLeftWidth)+parseFloat(r.paddingRight)+parseFloat(r.paddingLeft)+"px"),{sizingStyle:r,paddingSize:parseFloat(r.paddingBottom)+parseFloat(r.paddingTop),borderSize:parseFloat(r.borderBottomWidth)+parseFloat(r.borderTopWidth)})}(e);if(t){y.current=t;var r=function(e,t,n,r){void 0===n&&(n=1),void 0===r&&(r=1/0),Y||((Y=document.createElement("textarea")).setAttribute("tab-index","-1"),Y.setAttribute("aria-hidden","true"),Q(Y)),null===Y.parentNode&&document.body.appendChild(Y);var o=e.paddingSize,a=e.borderSize,s=e.sizingStyle,i=s.boxSizing;Object.keys(s).forEach((function(e){var t=e;Y.style[t]=s[t]})),Q(Y),Y.value=t;var c=function(e,t){var n=e.scrollHeight;return"border-box"===t.sizingStyle.boxSizing?n+t.borderSize:n-t.paddingSize}(Y,e);Y.value="x";var u=Y.scrollHeight-o,l=u*n;"border-box"===i&&(l=l+o+a),c=Math.max(l,c);var p=u*r;return"border-box"===i&&(p=p+o+a),[c=Math.min(p,c),u]}(t,e.value||e.placeholder||"x",a,o),s=r[0],i=r[1];h.current!==s&&(h.current=s,e.style.setProperty("height",s+"px","important"),u(s,{rowHeight:i}))}};return Object(r.useLayoutEffect)(b),p=G(b),Object(r.useEffect)((function(){var e=function(e){p.current(e)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),Object(r.createElement)("textarea",Object(B.a)({},l,{onChange:function(e){f||b(),i(e)},ref:d}))},ee=Object(r.forwardRef)(Z);function te(e){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ne(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function re(e,t){return(re=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function oe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ie(e);if(t){var o=ie(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return ae(this,n)}}function ae(e,t){return!t||"object"!==te(t)&&"function"!=typeof t?se(e):t}function se(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ce=Object(s.b)((function(e){return{isLoggedIn:e.currentUser.isLoggedIn,currentUser:e.currentUser.userData,isOpen:e.popup.isOpen,socket:e.socket.socket}}),(function(e){return{jumpToCommentDone:function(){return e({type:u.e})},jumpToReplyDone:function(){return e({type:u.f})}}}))(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&re(e,t)}(s,e);var t,n,r,a=oe(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={inputStyle:"textarea ",isDisabled:""},t.submitHandler=t.submitHandler.bind(se(t)),t.validateBlank=h.l.bind(se(t)),t.trimValue=h.j.bind(se(t)),t.inputHandler=t.inputHandler.bind(se(t)),t}return t=s,(n=[{key:"inputHandler",value:function(e){e.preventDefault();var t=e.target,n=t.name,r=t.value;this.setState(function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},n,r))}},{key:"submitHandler",value:function(e){if(13==e.keyCode&&0==e.shiftKey){e.preventDefault();var t=this.state.comment;if(this.validateBlank(t,"commentInput","textarea textarea--error")){var n={postId:this.props.postId,text:Object(h.j)(t),pageIndex:this.props.pageIndex,sortBy:this.props.sortBy,userId:this.props.userId,pageSize:this.props.pageSize,commentId:this.props.commentId||""};this.setState({isDisabled:"disabled"}),"input-reply"==this.props.style?(this.props.socket.emit("replyComment",n),this.props.jumpToReplyDone()):(this.props.jumpToCommentDone(),this.props.socket.emit("commentPost",n)),this.form.reset(),this.setState({inputStyle:"textarea ",isDisabled:"",comment:""})}}}},{key:"render",value:function(){var e=this,t=this.state,n=t.inputStyle,r=t.isDisabled,a="input-reply"==this.props.style?"Write your reply":"Write your comment";return o.a.createElement("form",{ref:function(t){return e.form=t},className:this.props.style},o.a.createElement("img",{src:this.props.avatar,className:"comment-avatar"}),o.a.createElement(ee,{ref:function(t){return e.commentInput=t},name:"comment",className:n,onChange:this.inputHandler,disabled:r,placeholder:a,onKeyDown:this.submitHandler,rows:1}))}}])&&ne(t.prototype,n),r&&ne(t,r),s}(r.Component));function ue(e){return(ue="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function le(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function pe(e,t){return(pe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function fe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=he(e);if(t){var o=he(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return me(this,n)}}function me(e,t){return!t||"object"!==ue(t)&&"function"!=typeof t?de(e):t}function de(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function he(e){return(he=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var ye=Object(s.b)(null,(function(e){return{onJumpToCommentDone:function(){return e({type:u.e})}}}))(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&pe(e,t)}(s,e);var t,n,r,a=fe(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={isReply:!1,comment:""},t.renderComments=t.renderComments.bind(de(t)),t.getFormatedDate=h.c.bind(de(t)),t.renderReplyInput=t.renderReplyInput.bind(de(t)),t.renderReplies=t.renderReplies.bind(de(t)),t}return t=s,(n=[{key:"renderComments",value:function(e,t){var n=this.getFormatedDate(t.date);if(this.props.isReply){var r=new Date(this.props.date).getTime();new Date(t.date).getTime()===r&&(e="reply special")}else this.props.commentId&&this.props.commentId==t._id&&(e=this.props.specialStyle?this.props.specialStyle:e);return o.a.createElement("div",{key:t._id},o.a.createElement("div",{className:e},o.a.createElement(l.b,{to:"/".concat(t.user._id)},o.a.createElement("img",{src:t.user.avatar,className:"comment-avatar"})),o.a.createElement("div",{className:"comment-content"},o.a.createElement("h6",{className:"comment-content__name"},t.user.name),o.a.createElement("span",{className:"comment-content__text"},t.text))),o.a.createElement("div",{className:"comment-footer"},e.includes("comment")&&o.a.createElement("a",{className:"btn-reply",onClick:this.renderReplies},"Reply (".concat(t.replies.length,")")),o.a.createElement("span",{className:"comment-footer__comment-date"},n)))}},{key:"renderReplies",value:function(){!this.state.isReply&&this.props.commentStyle?(this.props.onJumpToCommentDone(),this.setState({isReply:!1})):this.setState({isReply:!this.state.isReply})}},{key:"renderReplyInput",value:function(){var e;return this.props.userId&&(e=o.a.createElement(ce,{style:"input-reply",avatar:this.props.avatar,postId:this.props.postId,sortBy:this.props.sortBy,pageIndex:this.props.pageIndex,userId:this.props.userId,pageSize:this.props.pageSize,commentId:this.props.comment._id})),e}},{key:"render",value:function(){var e=this,t=this.props,n=t.comment,r=t.commentStyle;return this.state.isReply||r?o.a.createElement(o.a.Fragment,null,this.renderComments("comment",n),n.replies.map((function(t){return e.renderComments("reply",t)})),this.renderReplyInput()):o.a.createElement(o.a.Fragment,null,this.renderComments("comment",n))}}])&&le(t.prototype,n),r&&le(t,r),s}(r.Component));function be(e){return(be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ve(e){return function(e){if(Array.isArray(e))return ge(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ge(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function we(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_e(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Se(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Oe(e,t){return(Oe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ee(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ie(e);if(t){var o=Ie(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return je(this,n)}}function je(e,t){return!t||"object"!==be(t)&&"function"!=typeof t?Ne(e):t}function Ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ie(e){return(Ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Ce=Object(s.b)((function(e){return{isLoggedIn:e.currentUser.isLoggedIn,currentUser:e.currentUser.userData,isOpen:e.popup.isOpen,socket:e.socket.socket,notification:e.notification}}),(function(e){return{onOpen:function(){return e({type:u.h})},jumpToCommentDone:function(){return e({type:u.e})}}}))(Object(a.f)(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Oe(e,t)}(s,e);var t,n,r,a=Ee(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={postId:e.match.params.postId,filter:"newest",pageIndex:1,comments:[],pageSize:0,scrolling:!1,commentsTotal:0,isFilter:!1,hasChange:!1},t.mustGetComments=t.mustGetComments.bind(Ne(t)),t.renderComment=t.renderComment.bind(Ne(t)),t.loadComments=t.loadComments.bind(Ne(t)),t.handleScroll=t.handleScroll.bind(Ne(t)),t}return t=s,(n=[{key:"componentDidMount",value:function(){this.mustGetComments(this.state),this.loadComments(),this.props.notification.isJumpToComment&&window.scrollTo(0,this.postComment.offsetTop)}},{key:"UNSAFE_componentWillMount",value:function(){var e=this;this.scrollListener=window.addEventListener("scroll",(function(t){e.handleScroll(t)})),this.props.socket.on("hasChange".concat(this.state.postId),(function(){e.setState({hasChange:!0})}))}},{key:"handleScroll",value:function(e){var t=this.state,n=t.scrolling,r=t.commentsTotal,o=t.pageSize;if(!(n||r<=o)){var a=document.querySelector("div.post-comment__content > div.comment-footer:last-child");if(a){var s=a.offsetTop+a.clientHeight;window.pageYOffset+window.innerHeight>=s&&(this.setState({scrolling:!0}),this.mustGetComments(this.state))}}}},{key:"UNSAFE_componentWillUpdate",value:function(e,t){var n=this.state;t.filter!=n.filter&&(this.setState({isFilter:!0}),this.mustGetComments(we(we({},t),{},{pageSize:0}))),e.notification.isJumpToComment&&e.notification.commentId!=this.props.notification.commentId&&window.scrollTo(0,this.postComment.offsetTop),t.hasChange&&t.hasChange!=this.state.hasChange&&this.mustGetComments(t)}},{key:"mustGetComments",value:function(e){this.props.socket.emit("getComments",{postId:e.postId,sortBy:e.filter,pageSize:e.pageSize,hasChange:e.hasChange})}},{key:"loadComments",value:function(){var e=this;this.props.socket.on("returnCommentsOf".concat(this.state.postId),(function(t){if(t.error)e.setState({errorMessage:t.error});else{var n=e.state.comments;e.state.isFilter?e.setState({isFilter:!1,comments:t.comments,commentsTotal:t.commentsTotal,pageSize:t.comments.length,scrolling:!1}):!e.state.hasChange&&t.comments.length>1?e.setState({comments:[].concat(ve(n),ve(t.comments)),commentsTotal:t.commentsTotal,pageSize:n.length+t.comments.length,scrolling:!1}):e.state.hasChange?e.setState({comments:t.comments,commentsTotal:t.commentsTotal,pageSize:t.comments.length,scrolling:!1,hasChange:!1}):e.setState({comments:[].concat(ve(t.comments),ve(n)),commentsTotal:e.state.commentsTotal+t.comments.length,pageSize:n.length+t.comments.length,scrolling:!1})}}))}},{key:"componentWillUnmount",value:function(){this.props.jumpToCommentDone(),this.props.socket.off("returnCommentsOf".concat(this.state.postId)),this.props.socket.off("hasChange".concat(this.state.postId))}},{key:"setQueryConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{filter:filter};this.props.jumpToCommentDone(),this.setState(e)}},{key:"renderComment",value:function(){var e,t=this,n=this.state.comments;if(n.length){var r=!1;this.props.notification.isJumpToComment&&(n.unshift(n.splice(n.findIndex((function(e){return e._id===t.props.notification.commentId})),1)[0]),r=!0),e=n.map((function(e,n){var a=e._id,s=!1;return 0===n&&(s=!(!r||t.props.notification.commentStyle)&&"comment special"),o.a.createElement(ye,{key:a,specialStyle:s,isReply:t.props.notification.isReply,isLoggedIn:t.props.isLoggedIn,comment:e,postId:t.state.postId,avatar:t.props.currentUser.avatar,userId:t.props.currentUser.id,pageSize:t.state.pageSize,commentId:t.props.notification.commentId,date:t.props.notification.date,commentStyle:t.props.notification.commentStyle})}))}else e=o.a.createElement("h3",{className:"u-center-text u-text-bold u-color-light u-margin-top-big"},"No comment found");return e}},{key:"render",value:function(){var e=this,t=this.props.currentUser.avatar,n=this.state.commentsTotal;return o.a.createElement("div",{className:"post-comment"},o.a.createElement("div",{className:"post-comment__header"},o.a.createElement("h4",{className:"post-comment__title"},"Comments (".concat(n,")")),o.a.createElement(A,{onChange:function(t){e.setQueryConfig({filter:t})}})),this.props.isLoggedIn&&o.a.createElement(ce,{style:"input-comment",avatar:t,postId:this.state.postId,sortBy:this.state.filter,pageIndex:this.state.pageIndex,userId:this.props.currentUser.id,pageSize:this.state.pageSize}),!this.props.isLoggedIn&&o.a.createElement("div",null,o.a.createElement("h4",{className:"u-margin-bottom-small u-center-text u-text-normal"},"You must be logged in to post a comment"),o.a.createElement("a",{className:"u-margin-bottom-medium btn-primary u-center-btn",onClick:this.props.onOpen},"Log in")),o.a.createElement("div",{className:"post-comment__content",ref:function(t){return e.postComment=t}},this.renderComment()))}}])&&Se(t.prototype,n),r&&Se(t,r),s}(r.Component))),Re=n(41);function Pe(e){return(Pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function xe(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function De(e,t){return(De=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Te(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ze(e);if(t){var o=ze(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Ue(this,n)}}function Ue(e,t){return!t||"object"!==Pe(t)&&"function"!=typeof t?Le(e):t}function Le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ze(e){return(ze=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Fe=Object(s.b)((function(e){return{currentUser:e.currentUser.userData,userNotes:e.currentUser.notes,socket:e.socket.socket,isUpdate:e.postUpdate.isUpdate}}),(function(e){return{onUpdate:function(t){return e(function(e){return{type:u.p,payload:e}}(t))},updateDone:function(){return e({type:u.o})}}}))(Object(a.f)(function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&De(e,t)}(s,e);var t,n,r,a=Te(s);function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this,e)).state={postId:e.match.params.postId,isDelete:!1,isLoading:!0},t.deletePost=t.deletePost.bind(Le(t)),t.closeNoti=t.closeNoti.bind(Le(t)),t.onDelete=t.onDelete.bind(Le(t)),t.toastNoti=h.i.bind(Le(t)),t.updatePost=t.updatePost.bind(Le(t)),t.updateSocket=h.k.bind(Le(t)),t}return t=s,(n=[{key:"componentDidMount",value:function(){var e=this;this.props.socket.emit("getPost",this.state.postId),this.props.socket.on("returnPostOf".concat(this.state.postId),(function(t){e.setState({isLoading:!1}),t.error?e.setState({errorMessage:t.error}):e.setState({post:t})})),this.props.isUpdate&&(this.setState({updateMessage:"Updated successfully"}),this.props.updateDone())}},{key:"UNSAFE_componentWillMount",value:function(){this.updateSocket("post","returnPostOf".concat(this.state.postId))}},{key:"componentWillUnmount",value:function(){this.props.socket.off("returnPostOf".concat(this.state.postId))}},{key:"UNSAFE_componentWillUpdate",value:function(e,t){this.toastNoti(t),e.match.params.postId!=this.props.match.params.postId&&(this.props.socket.emit("getPost",e.match.params.postId),this.updateSocket("post","returnPostOf".concat(e.match.params.postId)))}},{key:"updatePost",value:function(){var e=this.state.post,t={name:e.name,address:e.address,avatar:e.avatar,content:e.content,category:e.category,id:this.state.postId};this.props.onUpdate(t),this.props.history.push("/review")}},{key:"deletePost",value:function(){this.setState({isDelete:!0})}},{key:"onDelete",value:function(){var e=this;c.a.delete("/api/post/".concat(this.state.postId)).then((function(t){e.props.socket.emit("deletePost",{userId:e.props.currentUser.id,postId:e.state.postId}),e.setState({post:"",successMessage:t.data.message})})).catch((function(t){e.setState({errorMessage:t.message||t.response.data.message})})).finally(this.setState({isDelete:!1}))}},{key:"closeNoti",value:function(){this.setState({isDelete:!1})}},{key:"render",value:function(){var e=this.state,t=e.post,n=e.postId,r=e.isDelete;if(e.isLoading)return o.a.createElement(Re.a,null);if(t){var a=this.props.currentUser,s=!1;return t.writer&&(s=a.id==t.writer._id),o.a.createElement(o.a.Fragment,null,o.a.createElement(O,{header:t,postId:n,socket:this.props.socket}),r&&o.a.createElement("div",{className:"delete-container"},o.a.createElement("div",{className:"delete-warning"},o.a.createElement("div",{className:"close-btn",onClick:this.closeNoti},o.a.createElement("div",{className:"close-btn__leftright close-line"}),o.a.createElement("div",{className:"close-btn__rightleft close-line"})),o.a.createElement("h3",{className:"delete-warning__title"},"Delete post"),o.a.createElement("span",{className:"delete-warning__content"},"Are you sure you want to permanently delete this post?"),o.a.createElement("a",{className:"btn-primary",onClick:this.onDelete},"Delete"))),o.a.createElement("div",{className:"post"},o.a.createElement("div",{dangerouslySetInnerHTML:{__html:t.content},className:"post__content"}),s&&o.a.createElement("div",{className:"post__edit-group-btn"},o.a.createElement("a",{className:"btn-page-control",onClick:this.updatePost},"Edit"),o.a.createElement("a",{className:"btn-delete",onClick:this.deletePost},"Delete"))),o.a.createElement(x,{footer:t,postId:n,socket:this.props.socket}),o.a.createElement(Ce,null))}return o.a.createElement("h2",{className:"u-center-text u-text-bold u-center-el u-color-light"},"No post found")}}])&&xe(t.prototype,n),r&&xe(t,r),s}(r.Component)));function We(e){return(We="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Ae(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Be(e,t){return(Be=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Me(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Ge(e);if(t){var o=Ge(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return He(this,n)}}function He(e,t){return!t||"object"!==We(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var Je=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Be(e,t)}(s,e);var t,n,r,a=Me(s);function s(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),a.call(this,e)}return t=s,(n=[{key:"render",value:function(){return o.a.createElement("section",{className:"section-destination-post u-margin-horizontal-5"},o.a.createElement(Fe,null))}}])&&Ae(t.prototype,n),r&&Ae(t,r),s}(r.Component)}}]);